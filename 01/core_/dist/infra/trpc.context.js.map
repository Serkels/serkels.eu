{"version":3,"sources":["../../src/infra/trpc.context.ts"],"sourcesContent":["//\n\nimport { initTRPC } from \"@trpc/server\";\nimport debug from \"debug\";\nimport { Lifecycle, injectable, scoped } from \"tsyringe\";\nimport type { OpenAPI_Repository } from \"./openapi.repository\";\n\n//\n\n@scoped(Lifecycle.ContainerScoped)\n@injectable()\nexport class OpenApiTrpc<Client> {\n  #log = debug(`~:core:infra:OpenApiTrpc`);\n\n  static readonly TOKEN = {\n    CLIENT: Symbol.for(\"client\"),\n    JWT: Symbol.for(\"jwt\"),\n  };\n\n  constructor(public readonly openapi: OpenAPI_Repository<Client>) {\n    this.#log(\"new\");\n  }\n\n  t = initTRPC.context<{ openapi: OpenAPI_Repository<Client> }>().create();\n  router = this.t.router;\n  procedure = this.t.procedure;\n}\n\n// export const createContext = async (opts: CreateNextContextOptions) => {\n//   const session = await getSession({ req: opts.req });\n\n//   return {\n//     openapi: new OpenAPI_Repository(fromServer, session?.user?.jwt),\n//     session,\n//   };\n// };\n// export type TRPCContext<Client> = {\n//   openapi: OpenAPI_Repository<Client>;\n//   session: {} | null;\n// };\n\n// export const TrpcContext = initTRPC.context<TRPCContext<Client>>()\n// .context<TRPCContext>()\n// .create({\n//   transformer: SuperJSON,\n//   errorFormatter: ({ shape, error }) => ({\n//     ...shape,\n//     data: {\n//       ...shape.data,\n//       zodError:\n//         error.cause instanceof ZodError ? error.cause.flatten() : null,\n//     },\n//   }),\n// })\n"],"names":["initTRPC","debug","Lifecycle","injectable","scoped","OpenApiTrpc","openapi","log","TOKEN","CLIENT","Symbol","for","JWT","constructor","t","context","create","router","procedure","ContainerScoped"],"mappings":"AAAA,EAAE;;;;;;;;;;AAEF,SAASA,QAAQ,QAAQ,eAAe;AACxC,OAAOC,WAAW,QAAQ;AAC1B,SAASC,SAAS,EAAEC,UAAU,EAAEC,MAAM,QAAQ,WAAW;AAOzD,WAAaC,cAAN;IAQuBC;IAP5B,CAACC,GAAG,CAAqC;IAEzC,OAAgBC,QAAQ;QACtBC,QAAQC,OAAOC,GAAG,CAAC;QACnBC,KAAKF,OAAOC,GAAG,CAAC;IAClB,EAAE;IAEFE,YAA4BP,QAAqC;uBAArCA;aAP5B,CAACC,GAAG,GAAGN,MAAM,CAAC,wBAAwB,CAAC;aAWvCa,IAAId,SAASe,OAAO,GAA4CC,MAAM;aACtEC,SAAS,IAAI,CAACH,CAAC,CAACG,MAAM;aACtBC,YAAY,IAAI,CAACJ,CAAC,CAACI,SAAS;QAL1B,IAAI,CAAC,CAACX,GAAG,CAAC;IACZ;IAEAO,EAAyE;IACzEG,OAAuB;IACvBC,UAA6B;AAC/B,EAEA,2EAA2E;CAC3E,yDAAyD;CAEzD,aAAa;CACb,uEAAuE;CACvE,eAAe;CACf,OAAO;CACP,KAAK;CACL,sCAAsC;CACtC,yCAAyC;CACzC,wBAAwB;CACxB,KAAK;CAEL,qEAAqE;CACrE,0BAA0B;CAC1B,YAAY;CACZ,4BAA4B;CAC5B,6CAA6C;CAC7C,gBAAgB;CAChB,cAAc;CACd,uBAAuB;CACvB,kBAAkB;CAClB,0EAA0E;CAC1E,SAAS;CACT,QAAQ;CACR,KAAK;CA3BJ;AAfYb;IAFZD,OAAOF,UAAUiB,eAAe;IAChChB;;;eASsC,8CAAA;;GAR1BE"}